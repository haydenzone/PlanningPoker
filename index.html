<html>
<head>
<!-- React JS -->
<script src="https://fb.me/react-0.14.3.js"></script>
<script src="https://fb.me/react-dom-0.14.3.js"></script>
 <script src="https://fb.me/JSXTransformer-0.13.3.js"></script>
<!-- Firebase -->
<script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>
<!-- ReactFire -->
<script src="https://cdn.firebase.com/libs/reactfire/0.5.1/reactfire.min.js"></script>

  <script src="https://code.jquery.com/jquery-2.1.4.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore.js"></script>
  <!-- Firebase -->
  <script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>
  <!-- ReactFire -->
  <script src="https://cdn.firebase.com/libs/reactfire/0.5.1/reactfire.min.js"></script>
</head>
<body>
  Test
  <div id="content">
  </div>
  <script type="text/jsx">
    var mountNode = $('#content')[0];
    var LoggedInApp = React.createClass({
     mixins: [ReactFireMixin],
     render: function() { 
      return <div>Welcome {this.props.username}</div>;
     }
   });
    var PlanningPokerApp = React.createClass({
     mixins: [ReactFireMixin],
     render: function() {
      var username = "";
      if(this.state.user) { 
        username = this.state.user.name
        return <LoggedInApp username={username}></LoggedInApp>;
      } else { 
       return <div>
       <input onChange={this.updateUserName} />
       <button onClick={this.onSetUser}>Set user</button>
         </div>;
      }
   },
   updateUserName: function(e) { 
    this.setState({
      inputUserName: e.target.value
    });
   },
   componentWillMount: function() {
    var storedUsername = localStorage.getItem("username");
      if(storedUsername) { 
        this.setUser(storedUsername);
      }
     var ref = new Firebase("https://boiling-inferno-273.firebaseio.com/items");
     this.bindAsArray(ref, "items");
   },
   onSetUser: function() { 
    this.setUser(this.state.inputUserName);
   },
   setUser: function(username) { 
     var userRef = new Firebase("https://boiling-inferno-273.firebaseio.com/user/"+username);
     this.bindAsObject(userRef, "user");
     this.firebaseRefs.user.set({
      name:username 
     });
     localStorage.setItem("username", username);
   },
   buttonClick: function() { 
    this.firebaseRefs.items.push("derp");
    this.firebaseRefs.user.set({
      name: 'hayden' + new Date()
    });
  }
});

    ReactDOM.render(<PlanningPokerApp name="John" />, mountNode);
  </script>
</body>
</html>
